<div id="main-navbar" class="fixed top-0 left-0 w-full z-50 transition-transform duration-300 ease-in-out shadow">
  {% render 'top-banner' %}
  {% render 'product-search-desktop' %}
  <div class="bg-background">
    <div class="container max-w-full">
      <div class="flex items-center justify-between py-2 md:py-4 relative">
        <a href="/"><img src="{{ 'logo.png' | asset_url }}" alt="Supercar Experience Logo" class="h-5 md:h-8"></a>

        <!-- MENU -->
        <ul class="lg:flex items-center hidden gap-2 uppercase lg:gap-8 text-sm lg:text-base font-medium absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2">
          <li>
            <a
              href="/collections/utv"
              class="relative inline-block whitespace-nowrap after:absolute after:bottom-0 after:left-0 after:h-[1px] after:w-0 after:bg-current after:transition-all after:duration-300 hover:after:w-full"
              >UTV</a
            >
          </li>

          <li>
            <a
              href="/collections/snowmobile"
              class="relative inline-block whitespace-nowrap after:absolute after:bottom-0 after:left-0 after:h-[1px] after:w-0 after:bg-current after:transition-all after:duration-300 hover:after:w-full"
              >Snowmobile</a
            >
          </li>

          <li>
            <a
              href="/collections/snowbike"
              class="relative inline-block whitespace-nowrap after:absolute after:bottom-0 after:left-0 after:h-[1px] after:w-0 after:bg-current after:transition-all after:duration-300 hover:after:w-full"
              >Snowbike</a
            >
          </li>

          <li>
            <a
              href="/pages/shock-service"
              class="relative inline-block whitespace-nowrap after:absolute after:bottom-0 after:left-0 after:h-[1px] after:w-0 after:bg-current after:transition-all after:duration-300 hover:after:w-full"
              >Shock Service</a
            >
          </li>
          <li>
            <a
              href="/pages/blogs"
              class="relative inline-block whitespace-nowrap after:absolute after:bottom-0 after:left-0 after:h-[1px] after:w-0 after:bg-current after:transition-all after:duration-300 hover:after:w-full"
              >Blog</a
            >
          </li>
          <li>
            <a
              href="/pages/about"
              class="relative inline-block whitespace-nowrap after:absolute after:bottom-0 after:left-0 after:h-[1px] after:w-0 after:bg-current after:transition-all after:duration-300 hover:after:w-full"
              >About</a
            >
          </li>
          <li>
            <a
              href="/pages/dealer-locator"
              class="relative inline-block whitespace-nowrap after:absolute after:bottom-0 after:left-0 after:h-[1px] after:w-0 after:bg-current after:transition-all after:duration-300 hover:after:w-full"
              >Dealers</a
            >
          </li>
        </ul>
        <div class="items-center gap-2 hidden lg:flex">
          <a href="/account" class="border border-black/30 shadow h-10 w-10 flex items-center justify-center">
            <i class="fa-regular fa-user"></i>
          </a>
          <a href="/cart" class="border border-black/30 shadow h-10 w-10 flex items-center justify-center relative">
            <i class="fa-regular fa-cart-shopping">
              <span
                class="cart-count-badge absolute -top-2 -right-2 bg-red-600 text-white text-xs rounded-full flex items-center justify-center h-5 w-5 {% unless cart.item_count > 0 %}hidden{% endunless %}"
              >
                {{ cart.item_count }}
              </span>
            </i>
          </a>
        </div>
        <div class="lg:hidden block pr-2">
          <button
            class="relative h-10 w-10 focus:outline-none"
            id="menu-toggle"
            aria-label="Toggle menu"
          >
            <span class="sr-only">Open main menu</span>
            <div class="absolute left-1/2 top-1/2 block w-5 -translate-x-1/2 -translate-y-1/2 transform">
              <span
                class="line1 absolute block h-0.5 w-5 transform bg-current transition duration-500 ease-in-out -translate-y-1.5"
                aria-hidden="true"
              ></span>
              <span
                class="line2 absolute block h-0.5 w-5 transform bg-current transition duration-500 ease-in-out"
                aria-hidden="true"
              ></span>
              <span
                class="line3 absolute block h-0.5 w-5 transform bg-current transition duration-500 ease-in-out translate-y-1.5"
                aria-hidden="true"
              ></span>
            </div>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Mobile Slide-Out Menu -->
<div
  id="mobile-slideout"
  class="fixed right-0 top-0 z-40 h-full w-full bg-white translate-x-full transition-transform duration-300 overflow-y-auto overflow-x-hidden overscroll-contain"
>
  <div class="flex flex-col justify-between h-full">
    <div class="flex flex-col items-center gap-5  pt-40 uppercase font-medium">
      {% render 'product-search-mobile' %}
      <a href="/collections/utv" class="block py-1 ml-2">UTV</a>
      <a href="/collections/snowmobile" class="block py-1 ml-2">Snowmobile</a>
      <a href="/collections/snowbike" class="block py-1 ml-2">Snowbike</a>
      <a href="/pages/shock-service" class="block py-1 ml-2">Shock Service</a>
      <a href="/pages/blogs" class="block py-1 ml-2">Blog</a>
      <a href="/pages/about" class="block py-1 ml-2">About</a>
      <a href="/pages/dealer-locator" class="block py-1 ml-2">Dealers</a>
    </div>
    <div class="flex justify-end gap-4 p-5">
      <div class="items-center gap-2 flex">
        <a href="/account" class="border border-black/30 shadow h-10 w-10 flex items-center justify-center">
          <i class="fa-regular fa-user"></i>
        </a>
        <a href="/cart" class="border border-black/30 shadow h-10 w-10 flex items-center justify-center relative">
          <i class="fa-regular fa-cart-shopping">
            <span
              class="cart-count-badge absolute -top-2 -right-2 bg-red-600 text-white text-xs rounded-full flex items-center justify-center h-5 w-5 {% unless cart.item_count > 0 %}hidden{% endunless %}"
            >
              {{ cart.item_count }}
            </span>
          </i>
        </a>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Menu toggle logic (unchanged)
    const toggle = document.getElementById('menu-toggle');
    const menu = document.getElementById('mobile-slideout');
    const line1 = toggle?.querySelector('.line1');
    const line2 = toggle?.querySelector('.line2');
    const line3 = toggle?.querySelector('.line3');

    if (toggle && menu && line1 && line2 && line3) {
      toggle.addEventListener('click', () => {
        line1.classList.toggle('rotate-45');
        line1.classList.toggle('-translate-y-1.5');
        line2.classList.toggle('opacity-0');
        line3.classList.toggle('-rotate-45');
        line3.classList.toggle('translate-y-1.5');
        menu.classList.toggle('translate-x-full');
        menu.classList.toggle('translate-x-0');
        document.body.classList.toggle('no-scroll');
        window.dispatchEvent(new CustomEvent('close-mobile-dropdown'));
      });
    }
  });

  document.addEventListener('DOMContentLoaded', () => {
    const navbar = document.getElementById('main-navbar');
    let lastScrollY = window.scrollY;

    window.addEventListener('scroll', () => {
      const currentScroll = window.scrollY;

      if (currentScroll > lastScrollY && currentScroll > 100) {
        // Scrolling down
        navbar.classList.add('-translate-y-full');
      } else {
        // Scrolling up
        navbar.classList.remove('-translate-y-full');
      }

      lastScrollY = currentScroll;
    });
  });
</script>
